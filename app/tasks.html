<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Required Meta tags -->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <!-- CSS -->
        <link rel="stylesheet" href="./resources/assets/libraries/CSS/metro-all.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">

        <!-- JavaScript -->
        <script src="./resources/assets/libraries/JS/metro.min.js"></script>
        <script src="./resources/assets/libraries/JS/jquery-3.6.0.js"></script>
        <script type="text/javascript" src="/eel.js"></script>
        <script type="text/javascript" src="./resources/JavaScript/browser.js"></script>

        <!-- HTML head tags -->
        <title>Mice Exchange | Tasks</title>
    </head>
    <body>
        <!-- Required resources -->
        <link rel="stylesheet" href="./resources/style/body.css">
        <link rel="stylesheet" href="./resources/style/sidebar.css">
        <script src="./resources/JavaScript/sidebar.js"></script>

        <!-- BODY -->
        <div class="container-fluid">
            <div class="no-overflow" style="height: 910px">
                <aside class="sidebar z-2 on-left sidebar-shadow" id="sb1" data-role-sidebar="true">
                    <div class="sidebar-header" data-image="images/sb-bg-1.jpg" style="background-color: var(--black);">
                        <button class="fg-white sub-action" onclick="close_sidebar()" style="background-color: var(--black); border: 0;"><span class="mif-arrow-left mif-2x" style="background-color: var(--black); cursor: pointer;" id="close_sidebar_span"></span></button>
                        <div class="avatar">
                            <img src=".\resources\assets\images\icons\app.png">
                        </div>
                        <span class="title fg-white">Mice Exchange | Crypto Bot</span>
                        <span class="subtitle fg-white"> 2023 Â© Shon Berengard</span>
                    </div>
                    <ul class="sidebar-menu hide-scroll" style="background-color: var(--white);">
                        <li><a href="bot.html"><span class="glyphicon glyphicon-user icon"></span>Crypto Bot</a></li>
                        <li class="divider"></li>
                        <li><a href="home.html"><span class="mif-home icon"></span>Home</a></li>
                        <li><a href="guides.html"><span class="glyphicon glyphicon-info-sign icon"></span>Guides</a></li>
                        <li><a href="resources.html"> <span class="mif-books icon"></span>Resources</a></li>
                        <li><a href="#"> <span class="glyphicon glyphicon-list-alt icon"></span>Tasks</a></li>
                        <li class="divider"></li>
                        <li><a href="settings.html"> <span class="glyphicon glyphicon-cog icon"></span>Settings</a></li>
                        <li><a href="logs.html"> <span class="glyphicon glyphicon-th-list icon"></span>Logs</a></li>
                        <li><a href="system.html"> <span class="glyphicon glyphicon-dashboard glyphicon-th-list icon"></span>System Info</a></li>
                        <li><a href="files.html"> <span class="glyphicon glyphicon-file icon"></span>Files</a></li>
                        <li class="divider"></li>
                        <li><a href="cli.html"> <span class="glyphicon glyphicon-chevron-right icon"></span>CLI</a></li>
                        <li><a href="exit.html"> <span class="glyphicon glyphicon-off icon"></span>Poweroff</a></li>
                    </ul>
                </aside>
                <div class="aaa h-100 p-ab">
                    <div class="app-bar bg-red z-1" data-role="appbar" id="app-bar-1" data-role-appbar="true" ><button type="button" class="hamburger menu-down hidden" style="display: none;"><span class="line"></span><span class="line"></span><span class="line"></span></button>
                        <button class="app-bar-item c-pointer" id="sidebar_toggle" onclick="open_sidebar()"><span class="mif-menu fg-white" style="font-size: 30px;"></span></button>
                    </div>
                    <br>
                    <div class="container"> <!-- or h-100 p-4 -->
                        <div data-role="panel" style="width:100%; height: 750px; border: 2px solid var(--red); background-color: #12121226; overflow: hidden;">
                            <p ><center style="color: var(--black); font-weight: 700; font-size: 35px;">Task List</center></p>
                            <center><span style="color: var(--orange); font-weight: 700; font-size: 20px;">Tasks: <p id="tasks-amount" style="display: contents;">0</p></span></center>
                            <input id="given_task" type="text" data-role="input" data-clear-button="true" placeholder="Enter a task > > > " style="font-size: 18px; color: var(--black); font-weight: 400; font-family: cursive;">
                            <center>
                                <button class="button yellow shadowed" id="submit" style="margin-top: 10px; color:var(--black); font-size: 20px; border-radius: 10px;"><span class="glyphicon glyphicon-plus"></span> Add Task</button>
                            </center>
                            <div data-role="panel" style="width:100%; height: 634px; border-radius: 5px; background-color: #cecece; margin:auto; overflow: scroll;">
                                <div class="suggest-box" style="margin-bottom: 10px;">
                                    <div id="tasks-container">
                                        <ul id="tasks-container-list">
                                            <!-- <li>Task one
                                                <a onclick="DeleteTask(event)"><span id="add" class="glyphicon glyphicon-ok"></span></a>
                                                <a onclick="DeleteTask(event)"><span id="remove" class="glyphicon glyphicon-remove"></span></a>
                                            </li>  -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <!-- <div class="container-fluid">
            <h1>FOOTER</h1>
        </div> -->
        <style>
            .panel {
                margin-top: 30px;
            }

            #tasks-container-list li {
            background-color: white;
            border: 2px solid white;
            border-radius: 15px;
            height: 40px;
            font-size: 25px;
            padding-left: 10px;
            opacity: 70%;
            overflow: hidden;

        }

        #tasks-container-list {
            list-style-type: none;
        }        

        #tasks-container {
            list-style-type: none;
        }

        .remove {
            background-color: #ffffff00;
            border: 0;
            float: right; 
            margin-right: 10px; 
            margin-top: 7px; 
            color: var(--red); 
            cursor: pointer;
        }        
        .remove:hover {
            color: #4e0000;
            cursor: pointer;
        }
        
        .add {
            background-color: #ffffff00;
            border: 0;
            float: right; 
            margin-right: 10px; 
            margin-top: 6px; 
            color: #00ff0dbe;
            cursor: pointer;
        }
        
        .add:hover {
            color: #005204be;
            cursor: pointer;
        }
        </style>
    </body>

    <script>
        
        function DeleteTask(event) { 
            const element = event.target;
            // console.log($(element).parent().parent())
            $(element).parent().parent().remove();
            
            var reg = /\d/g;
            var match = $(element).parent().parent().match(reg);

            if (match.length == 1){
                $(match[0]).parent().parent().remove();
            }else{
                console.log(match);
            }
        }

        var tasks = []
        var takenIDs = []
        var tasksStorage = new Map()
        var counter = 0

        if (window.localStorage.getItem("Tasks") && window.localStorage.getItem("Tasks-amount")) {
            Tasks = window.localStorage.getItem("Tasks")
            Tasks = JSON.parse(Tasks)

            task_container = document.getElementById("tasks-container-list");
            for (const key in Tasks){
                task_container.insertAdjacentHTML("afterbegin",Tasks[key])

                tasks.push(Tasks[key])
                takenIDs.push(key)

            }

            counter = window.localStorage.getItem("Tasks-amount")
            $("#tasks-amount").text(counter);

            $("#submit").click(function(){
                if (given_task.value == "" || given_task.value == "Please enter a valid task. . .") {
                    given_task.value = "Please enter a valid task. . .";
                    return;
                }

                // Make a loop with all of the tasks inside an array and check their id for a free and not taken one
                if (tasks.length > 0) {
                    li = document.createElement("li");
                    newID = parseInt(takenIDs[takenIDs.length-1])+1;
                    li.id = "task-"+newID;

                    takenIDs.push(newID)
                    tasks.push(`<li id="${li.id}">${given_task.value}<a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-ok add"></span></a><a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-remove remove"></span></a></li><br id="${newID}">`);

                    //$("#tasks-container-list").append(`<li id="${li.id}">${given_task.value}<a onclick="DeleteTask(event)"><span id="add" class="glyphicon glyphicon-ok"></span></a><a onclick="DeleteTask(event)"><span id="remove" class="glyphicon glyphicon-remove"></span></a></li><br id="${newID}">`)
                    task_container = document.getElementById("tasks-container-list");
                    task_container.insertAdjacentHTML("afterbegin",`<li id="${li.id}">${given_task.value}<a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-ok add"></span></a><a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-remove remove"></span></a></li><br id="${newID}">`)

                    counter = 0
                    for (task of tasks) {
                        counter++;
                    }
                    $("#tasks-amount").html(counter);
                    given_task.value = "";


                }else{
                    li = document.createElement("li");
                    li.id = "task-"+0;

                    tasks.push(`<li id="task-0">${given_task.value}<a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-ok add"></span></a><a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-remove remove"></span></a></li><br id="0">`);
                    takenIDs.push(0)

                    task_container = document.getElementById("tasks-container-list");
                    task_container.insertAdjacentHTML("afterbegin",`<li id="task-0">${given_task.value}<a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-ok add"></span></a><a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-remove remove"></span></a></li><br id="0">`)
                    //$("#tasks-container-list").append(`<br id="${newID}"> <li id="task-0">${given_task.value}<a onclick="DeleteTask(event)"><span id="add" class="glyphicon glyphicon-ok"></span></a><a onclick="DeleteTask(event)"><span id="remove" class="glyphicon glyphicon-remove"></span></a></li><br id="${newID}">`)
                    
                    counter = 0
                    for (task of tasks) {
                        counter++;
                    }
                    $("#tasks-amount").text(counter);
                    given_task.value = "";
                }

                // Save as JSON and to the LocalStorage
                for (id of takenIDs){
                    tasksStorage[id] = tasks[id]
                }

                window.localStorage.setItem("Tasks", JSON.stringify(tasksStorage))
                window.localStorage.setItem("Tasks-amount", document.getElementById("tasks-amount").innerHTML)
            }) 
        }else{
            $("#submit").click(function(){
                if (given_task.value == "" || given_task.value == "Please enter a valid task. . .") {
                    given_task.value = "Please enter a valid task. . .";
                    return;
                }

                // Make a loop with all of the tasks inside an array and check their id for a free and not taken one
                if (tasks.length > 0) {
                    li = document.createElement("li");
                    newID = (takenIDs[takenIDs.length-1]+1);
                    li.id = "task-"+newID;

                    takenIDs.push(newID)
                    tasks.push(`<li id="${li.id}">${given_task.value}<a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-ok add"></span></a><a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-remove remove"></span></a></li><br id="${newID}">`);

                    //$("#tasks-container-list").append(`<li id="${li.id}">${given_task.value}<a onclick="DeleteTask(event)"><span id="add" class="glyphicon glyphicon-ok"></span></a><a onclick="DeleteTask(event)"><span id="remove" class="glyphicon glyphicon-remove"></span></a></li><br id="${newID}">`)
                    task_container = document.getElementById("tasks-container-list");
                    task_container.insertAdjacentHTML("afterbegin",`<li id="${li.id}">${given_task.value}<a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-ok add"></span></a><a onclick="DeleteTask(event)"><span  class="glyphicon glyphicon-remove remove"></span></a></li><br id="${newID}">`)

                    counter = 0
                    for (task of tasks) {
                        counter++;
                    }
                    $("#tasks-amount").html(counter);
                    given_task.value = "";


                }else{
                    li = document.createElement("li");
                    li.id = "task-"+0;

                    tasks.push(`<li id="task-0">${given_task.value}<a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-ok add"></span></a><a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-remove remove"></span></a></li><br id="0">`);
                    takenIDs.push(0)

                    task_container = document.getElementById("tasks-container-list");
                    task_container.insertAdjacentHTML("afterbegin",`<li id="task-0">${given_task.value}<a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-ok add"></span></a><a onclick="DeleteTask(event)"><span class="glyphicon glyphicon-remove remove"></span></a></li><br id="0">`)
                    counter = 0
                    for (task of tasks) {
                        counter++;
                    }
                    $("#tasks-amount").text(counter);
                    given_task.value = "";
                }

                // Save as JSON and to the LocalStorage
                for (id of takenIDs){
                    tasksStorage[id] = tasks[id]
                }

                window.localStorage.setItem("Tasks", JSON.stringify(tasksStorage))
                window.localStorage.setItem("Tasks-amount", document.getElementById("tasks-amount").innerHTML)
            }) 
        }
    </script>
</html>